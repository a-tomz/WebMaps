<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTA Bus Stops - Dynamic Satellite Map</title>
    <script src="https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.css" rel="stylesheet" />
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        
        /* Custom styling for the popup to make it look cleaner */
        .maplibregl-popup-content {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>

<div id="map"></div>

<script>
// 5. INTERACTIVITY: SHOW ALL ROUTES AT THIS LOCATION
    map.on('click', 'unclustered-point', (e) => {
        const coordinates = e.features[0].geometry.coordinates.slice(0, 2);
        const stopNum = e.features[0].properties.StopNumber;

        // Find all features at the clicked point (to get all overlapping routes)
        const features = map.queryRenderedFeatures(e.point, {
            layers: ['unclustered-point']
        });

        // Extract and unique-ify the routes found at this spot
        const routes = [...new Set(features.map(f => f.properties.Route))];
        const routeListHTML = routes.map(r => `<li>Route ${r}</li>`).join('');

        new maplibregl.Popup()
            .setLngLat(coordinates)
            .setHTML(`
                <div style="text-align: left; min-width: 150px;">
                    <strong style="font-size: 1.1em;">Stop #${stopNum}</strong><br>
                    <hr style="margin: 8px 0;">
                    <p style="margin: 0 0 5px 0;"><strong>Routes serving this stop:</strong></p>
                    <ul style="margin: 0; padding-left: 20px;">
                        ${routeListHTML}
                    </ul>
                </div>
            `)
            .addTo(map);
    });
</script>

</body>
</html>


